<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†å¸³çµ‚çµè€… | Split The Bill</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ’¸</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head> 
<body>

<div class="container">
    <div class="card">
        <h1>
            <i class="fa-solid fa-money-bill-wave" style="color: var(--primary);"></i>            åˆ†å¸³çµ‚çµè€…
            <span>Cost Allocation System</span>
        </h1>

        <label>ğŸ’° é¤é»ç¸½é‡‘é¡ (Food)</label>
        <input type="number" id="foodTotal" placeholder="è¼¸å…¥é‡‘é¡" value="">

        <label>ğŸº é…’æ°´ç¸½é‡‘é¡ (Alcohol)</label>
        <input type="number" id="alcoholTotal" placeholder="æ²’å–é…’å¡« 0" value="0">

        <div class="checkbox-wrapper">
            <input type="checkbox" id="serviceCharge" checked>
            <label for="serviceCharge" style="margin:0">åŠ æ”¶ 10% æœå‹™è²»</label>
        </div>
    </div>

    <div class="card">
        <label>ğŸ‘¥ åˆ†æ¯åå–®</label>
        <div class="friend-input-group">
            <input type="text" id="newFriend" placeholder="è¼¸å…¥åå­—" style="margin:0">
            <button class="btn btn-primary" style="width: 80px; margin:0;" onclick="addFriend()">
                <i class="fa-solid fa-plus"></i> æ–°å¢
            </button>
        </div>

        <div class="friend-list" id="friendList">
            </div>

        <button class="btn btn-primary" onclick="calculate()">
            <i class="fa-solid fa-calculator"></i> ä¸€éµç®—éŒ¢
        </button>

        <div class="result-section" id="resultSection">
            <h3>è¨ˆç®—çµæœ</h3>
            <div id="resultList"></div>
            <canvas id="billChart"></canvas>
        </div>
    </div>
</div>

<script>
    // --- é—œéµä¿®æ”¹ï¼šé…åˆæ·±è‰²æ¨¡å¼ï¼ŒæŠŠåœ–è¡¨æ–‡å­—è®Šç™½ ---
    Chart.defaults.color = '#ffffff';       // æ–‡å­—è®Šç™½
    Chart.defaults.borderColor = '#555';    // æ ¼ç·šè®Šæ·±ç°
    // ------------------------------------------

    // è³‡æ–™çµæ§‹ï¼šå„²å­˜æ‰€æœ‰æœ‹å‹
    let friends = [
        { name: 'æˆ‘ (ä¸»æª)', drink: false },
        { name: 'åŒå­¸ A', drink: true }
    ];

    // åˆå§‹åŒ–ç•«é¢
    renderFriends();

    // 1. æœ‹å‹åˆ—è¡¨ç®¡ç†
    function addFriend() {
        const nameInput = document.getElementById('newFriend');
        const name = nameInput.value.trim();
        if (!name) return;
        friends.push({ name: name, drink: false });
        nameInput.value = '';
        renderFriends();
    }

    function removeFriend(index) {
        friends.splice(index, 1);
        renderFriends();
    }

    function toggleDrink(index) {
        friends[index].drink = !friends[index].drink;
        // ä¸éœ€é‡æ–° renderï¼Œç‹€æ…‹å·²è®Šæ›´
    }

    function renderFriends() {
        const list = document.getElementById('friendList');
        list.innerHTML = '';
        friends.forEach((f, idx) => {
            list.innerHTML += `
                <div class="friend-item">
                    <span>${f.name}</span>
                    <div class="friend-options">
                        <div style="display:flex; align-items:center;">
                            <input type="checkbox" ${f.drink ? 'checked' : ''} onchange="toggleDrink(${idx})">
                            <small style="margin-left:5px;">å–é…’</small>
                        </div>
                        <button class="del-btn" onclick="removeFriend(${idx})">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
        });
    }

    // 2. æ ¸å¿ƒè¨ˆç®—é‚è¼¯ & Chart.js
    let myChart = null;

    function calculate() {
        let food = parseFloat(document.getElementById('foodTotal').value) || 0;
        let alcohol = parseFloat(document.getElementById('alcoholTotal').value) || 0;
        const hasService = document.getElementById('serviceCharge').checked;

        if (friends.length === 0) { alert('æ²’æœ‰äººè¦ä»˜éŒ¢å—ï¼Ÿ'); return; }

        if (hasService) {
            food = Math.round(food * 1.1);
            alcohol = Math.round(alcohol * 1.1);
        }

        const foodPerPerson = Math.ceil(food / friends.length);
        const drinkers = friends.filter(f => f.drink);
        const alcoholPerPerson = drinkers.length > 0 ? Math.ceil(alcohol / drinkers.length) : 0;

        const resultList = document.getElementById('resultList');
        resultList.innerHTML = '';
        const names = [];
        const amounts = [];

        friends.forEach(f => {
            let total = foodPerPerson;
            let note = '(ç´”åƒé£¯)';
            if (f.drink) {
                total += alcoholPerPerson;
                note = '(å«é…’éŒ¢)';
            }
            
            names.push(f.name);
            amounts.push(total);

            resultList.innerHTML += `
                <div class="result-item">
                    <span>${f.name} <small style="color:#aaa">${note}</small></span>
                    <span class="money">$${total}</span>
                </div>
            `;
        });

        document.getElementById('resultSection').style.display = 'block';

        const ctx = document.getElementById('billChart').getContext('2d');
        if (myChart) myChart.destroy();

        myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: names,
                datasets: [{
                    label: 'æ‡‰ä»˜é‡‘é¡',
                    data: amounts,
                    backgroundColor: amounts.map(a => a > foodPerPerson ? '#ff6b6b' : '#54a0ff'),
                    borderWidth: 0 // æ‹¿æ‰é‚Šæ¡†æ¯”è¼ƒå¥½çœ‹
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false },
                    title: { display: true, text: 'è²»ç”¨åˆ†æ”¤è¦–è¦ºåŒ–' }
                },
                scales: {
                    y: { 
                        beginAtZero: true,
                        grid: { color: 'rgba(255, 255, 255, 0.1)' } // è®“æ ¼ç·šä¹Ÿè®ŠåŠé€æ˜ç™½
                    },
                    x: {
                        grid: { display: false } // Xè»¸ä¸é¡¯ç¤ºæ ¼ç·šæ¯”è¼ƒä¹¾æ·¨
                    }
                }
            }
        });
    }
</script>

</body>
</html>